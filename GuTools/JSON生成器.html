<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>咕咕牛图库工具</title>
    <link rel="icon" href="favicon.ico" type="image/x-icon">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/Public.css">
    <link rel="stylesheet" href="css/Home.css">
    <link rel="stylesheet" href="css/Gu_Tools/GuTools_Main.css">
    <link rel="stylesheet" href="css/Gu_Tools/GuTools_Generator.css">
    <link rel="stylesheet" href="css/Gu_Tools/GuTools_Import.css">
    <link rel="stylesheet" href="css/Gu_Tools/GuTools_MD5.css">
    <link rel="stylesheet" href="css/Gu_Tools/GuTools_Sequence.css">
    <link rel="stylesheet" href="css/Gu_Tools/GuTools_JsonCal.css">
    <link rel="stylesheet" href="css/Data_List.css">
    <link rel="stylesheet" href="css/Plugin_Gallery.css">
    <link rel="stylesheet" href="css/Advanced_Management.css">
    <link rel="stylesheet" href="css/Other.css">
</head>
<body>

    <div class="container">
        <div class="tab-navigation">
            <img id="app-logo" src="/logo.png" alt="App Logo">
            <button class="tab-button active" data-tab="homePane">🐂</button>
            <button class="tab-button" data-tab="GuTools">咕咕牛工具</button>
            <button class="tab-button" data-tab="dataListPane">云端Json数据</button>
            <button class="tab-button" data-tab="pluginGalleryPane">插件图片管理</button>
            <button class="tab-button" data-tab="advancedManagementPane" id="advanced-mgmt-button">高级管理</button>
            <div id="navFooterInfo">
                <div>咕咕牛 v2.0</div>
                <div id="currentTime">--/--/-- --:--:--</div>
            </div>
        </div>

        <div class="tab-content">
            <div id="homePane" class="tab-pane active">
                <div class="sticky-note-container">
                    <div id="galleryStatusNote" class="sticky-note">
                        <div class="sticky-note-title">图库状态</div>
                        <div class="sticky-note-content">
                            <p id="galleryStatusText">正在加载状态...</p>
                            <label class="switch-large">
                                <input type="checkbox" id="galleryToggleSwitch">
                                <span class="slider-large"></span>
                            </label>
                        </div>
                    </div>
                    <div id="mihoyoStatusNote" class="sticky-note">
                        <div class="sticky-note-title">官方立绘</div>
                        <div class="sticky-note-content">
                            <p id="mihoyoStatusText">正在加载状态...</p>
                            <label class="switch-large">
                                <input type="checkbox" id="mihoyoToggleSwitch">
                                <span class="slider-large"></span>
                            </label>
                        </div>
                    </div>
                    <div id="px18StatusNote" class="sticky-note">
                        <div class="sticky-note-title">Px18 (轻色情) 模式</div>
                        <div class="sticky-note-content">
                            <p id="px18StatusText">正在加载状态...</p>
                            <label class="switch-large">
                                <input type="checkbox" id="px18ToggleSwitch">
                                <span class="slider-large"></span>
                            </label>
                        </div>
                    </div>
                    <div id="rx18StatusNote" class="sticky-note">
                        <div class="sticky-note-title">Rx18 (重度色情) 模式</div>
                        <div class="sticky-note-content">
                            <p id="rx18StatusText">正在加载状态...</p>
                            <label class="switch-large">
                                <input type="checkbox" id="rx18ToggleSwitch">
                                <span class="slider-large"></span>
                            </label>
                        </div>
                    </div>
                </div>
            </div>

            <div id="GuTools" class="tab-pane">
                <div id="generatorPaneView" class="gu-tools-view">
                    <div class="gu-tools-title-bar">
                        <div class="gu-tools-mode-buttons">
                            <button id="switchToGeneratorBtnGen" data-mode="generator" class="mode-button active" title="切换到JSON生成模式">JSON生成</button>
                            <button id="switchToImportBtnGen" data-mode="import" class="mode-button" title="切换到图片入库模式">图片入库</button>
                            <button id="switchToMD5BtnGen" data-mode="md5" class="mode-button" title="切换到MD5校准模式">MD5校准</button>
                            <button id="switchToSequenceBtnGen" data-mode="sequence" class="mode-button" title="切换到序号管理模式">序号管理</button>
                            <button id="switchToJSONCalBtnGen" data-mode="json_calibration" class="mode-button" title="切换到JSON校准模式">JSON校准</button> 
                        </div>
                    </div>
                    <div class="main-content">
                        <div class="left-panel">
                            <div class="search-wrapper">
                                <label for="searchInput">输入角色名/文件名 (模糊搜索):</label>
                                <input type="text" id="searchInput" autocomplete="off" disabled placeholder="正在加载图片列表...">
                                <div id="suggestions" class="hidden"></div>
                            </div>
                            <div id="previewArea">
                                <p>图片预览</p>
                                <img id="previewImage" src="" alt="选择的角色图片" class="hidden">
                            </div>
                        </div>
                        <div class="right-panel">
                            <div id="attributesPanel" class="initially-hidden">
                                <h4>图片属性</h4>
                                <div class="attribute-groups-wrapper">
                                    <div class="attribute-group"><label class="group-label">限制级:</label><label><input type="radio" name="rating" value="none" checked> 无</label><label><input type="radio" name="rating" value="px18"> Px18</label><label><input type="radio" name="rating" value="rx18"> Rx18</label></div>
                                    <div class="attribute-group"><label class="group-label">构图:</label><label><input type="radio" name="layout" value="normal" checked> 人像图</label><label><input type="radio" name="layout" value="fullscreen"> 全屏图</label><label><input type="radio" name="layout" value="catcake"> [🐱猫猫糕🐱]</label></div>
                                    <div class="attribute-group"><label class="group-label">特殊:</label><label><input type="checkbox" id="isEasterEggCheckbox"> 彩蛋</label><label><input type="checkbox" id="isAiImageCheckbox"> AI图</label></div>
                                </div>
                                <div id="gameTagsContainer"><span id="gameTagGs" class="game-tag">原神</span><span id="gameTagSr" class="game-tag">星铁</span><span id="gameTagZzz" class="game-tag">绝区零</span><span id="gameTagWaves" class="game-tag">鸣潮</span></div>
                                <div id="fileInfoContainer"><div class="info-group"><label for="md5DisplayInput">MD5:</label><input type="text" id="md5DisplayInput" readonly placeholder="选择后计算..."></div><div class="info-group"><label for="idDisplayInput">GID:</label><input type="text" id="idDisplayInput" readonly placeholder="选择后生成..."></div></div>
                                <p id="entryCountDisplay">Json数据量: 0 条</p>
                            </div>
                            <div class="action-area"><button id="saveButton" disabled>保存到 ImageData.json</button><div id="messageArea"></div></div>
                        </div>
                    </div>
                </div>
                <div id="importPaneView" class="gu-tools-view hidden">
                    <div class="gu-tools-title-bar">
                        <div class="gu-tools-mode-buttons">
                            <button id="switchToGeneratorBtnImp" data-mode="generator" class="mode-button" title="切换到JSON生成模式">JSON生成</button>
                            <button id="switchToImportBtnImp" data-mode="import" class="mode-button active" title="切换到图片入库模式">图片入库</button>
                            <button id="switchToMD5BtnImp" data-mode="md5" class="mode-button" title="切换到MD5校准模式">MD5校准</button>
                            <button id="switchToSequenceBtnImp" data-mode="sequence" class="mode-button" title="切换到序号管理模式">序号管理</button>
                            <button id="switchToJSONCalBtnImp" data-mode="json_calibration" class="mode-button" title="切换到JSON校准模式">JSON校准</button> 
                        </div>
                    </div>
                    <div class="import-content-wrapper">
                         <div class="import-left-panel">
                            <div class="form-group"><label for="tempImageSearchInput">搜索待入库图片 (imgtemp 目录):</label><div class="search-wrapper-import"><input type="text" id="tempImageSearchInput" autocomplete="off" placeholder="输入文件名搜索..."><div id="tempImageSuggestions" class="suggestions-import hidden"></div></div></div>
                            <div id="tempImagePreviewArea"><p>图片预览</p><img id="tempImagePreview" src="" alt="待入库图片预览" class="hidden"></div>
                        </div>
                        <div class="import-right-panel">
                            <div id="importAttributesPanel"><h4>图片属性</h4><div class="attribute-groups-wrapper"><div class="attribute-group"><label class="group-label">限制级:</label><label><input type="radio" name="importRating" value="none" checked> 无</label><label><input type="radio" name="importRating" value="px18"> Px18</label><label><input type="radio" name="importRating" value="rx18"> Rx18</label></div><div class="attribute-group"><label class="group-label">构图:</label><label><input type="radio" name="importLayout" value="normal" checked> 人像图</label><label><input type="radio" name="importLayout" value="fullscreen"> 全屏图</label><label><input type="radio" name="importLayout" value="catcake"> [🐱猫猫糕🐱]</label></div><div class="attribute-group"><label class="group-label">特殊:</label><label><input type="checkbox" id="importIsEasterEggCheckbox"> 彩蛋</label><label><input type="checkbox" id="importIsAiImageCheckbox"> AI图</label></div></div></div>
                            <div class="naming-section"><div class="naming-input-row"><div class="form-group"><label for="targetFolderSearchInput">搜索或指定目标文件夹:</label><div class="search-wrapper-import"><input type="text" id="targetFolderSearchInput" autocomplete="off" placeholder="例如: 心海 (可模糊搜索)"><div id="targetFolderSuggestions" class="suggestions-import hidden"></div></div></div><div class="form-group"><label for="finalFilenameInput">最终文件名 (自动生成):</label><div class="filename-input-wrapper" style="position: relative; display: flex; align-items: center;"><input type="text" id="finalFilenameInput" placeholder="选择后自动生成..." readonly><button id="editFilenameButton" class="edit-filename-btn hidden" title="修改文件名">✏️</button></div></div></div><div class="form-group" style="margin-top: 15px;"><label for="importDownloadSourceInput">下载来源 (可选):</label><input type="text" id="importDownloadSourceInput" placeholder="例如: Pixiv Web"></div></div>
                            <div class="action-area-import"><button id="addToGalleryButton" class="import-button" disabled>添加到图库</button><div id="importMessageArea"></div></div>
                        </div>
                    </div>
                </div>
                <div id="md5PaneView" class="gu-tools-view hidden">
                    <div class="gu-tools-title-bar">
                        <div class="gu-tools-mode-buttons">
                             <button id="switchToGeneratorBtnMD5" data-mode="generator" class="mode-button" title="切换到JSON生成模式">JSON生成</button>
                             <button id="switchToImportBtnMD5" data-mode="import" class="mode-button" title="切换到图片入库模式">图片入库</button>
                             <button id="switchToMD5BtnMD5" data-mode="md5" class="mode-button active" title="切换到MD5校准模式">MD5校准</button>
                             <button id="switchToSequenceBtnMD5" data-mode="sequence" class="mode-button" title="切换到序号管理模式">序号管理</button>
                             <button id="switchToJSONCalBtnMD5" data-mode="json_calibration" class="mode-button" title="切换到JSON校准模式">JSON校准</button> 
                        </div>
                    </div>
                    <div class="tool-content-wrapper md5-layout-wrapper">
                        <div class="md5-column md5-left-column"><h4 class="column-title">JSON 记录列表 (<span id="jsonTotalEntriesDisplay">0</span>)</h4><div id="jsonMd5ListContainer" class="scrollable-list"><p class="list-placeholder">等待加载 JSON 数据...</p></div></div>
                        <div class="md5-column md5-middle-column"><h4 class="column-title">校准控制与状态</h4><div class="md5-calibration-area">
                            <div class="calibration-controls full-width-buttons"><button id="startMD5Calibration" class="tool-button">开始校准</button>
                                <button id="abortMD5Calibration" class="tool-button abort-button" disabled>中止校准</button></div>
                            <div id="md5CalibrationStatus" class="calibration-status"><p>图库文件: <span id="totalFilesChecked">--</span></p>
                                <p>已检查: <span id="filesCheckedCount">0</span></p><p>JSON 记录数: <span id="totalMD5Count">--</span></p>
                                <p style="color: var(--warning-color);">MD5 不一致: <span id="mismatchedMD5Count">0</span></p>
                                <p id="md5CalibrationProgress" style="font-size: 0.85em; color: var(--secondary-text-color); margin-top: 5px; min-height: 1.2em;"></p>
                            </div>
                            <progress id="md5CalibrationProgressBar" value="0" max="100" style="width: 100%; margin-top: 5px; display: none;"></progress>
                            <button id="fixAllMismatchedMD5" class="tool-button fix-button full-width-button disabled" title="使用计算出的实际 MD5 更新所有不一致的 JSON 条目">修复所有不一致项</button>
                            <div class="extra-info-area">
                                <h5 class="extra-info-title">文件存在但 JSON 无记录 (<span id="filesNotInJsonCount">0</span>)</h5>
                                <textarea id="filesNotInJsonList" class="mismatched-list extra-info-list" placeholder="文件存在但 JSON 中没有对应记录的文件将显示在此..." readonly></textarea>
                            </div></div></div>
                        <div class="md5-column md5-right-column"><h4 class="column-title">不一致列表 (<span id="mismatchedCountDisplay">0</span>)</h4>
                            <textarea id="mismatchedMD5List" class="scrollable-list mismatched-list" placeholder="MD5 不一致的文件将显示在此..." readonly></textarea></div>
                    </div>
                </div>
                <div id="sequencePaneView" class="gu-tools-view hidden">
                     <div class="gu-tools-title-bar">
                         <div class="gu-tools-mode-buttons">
                              <button id="switchToGeneratorBtnSeq" data-mode="generator" class="mode-button" title="切换到JSON生成模式">JSON生成</button>
                              <button id="switchToImportBtnSeq" data-mode="import" class="mode-button" title="切换到图片入库模式">图片入库</button>
                              <button id="switchToMD5BtnSeq" data-mode="md5" class="mode-button" title="切换到MD5校准模式">MD5校准</button>
                              <button id="switchToSequenceBtnSeq" data-mode="sequence" class="mode-button active" title="切换到序号管理模式">序号管理</button>
                              <button id="switchToJSONCalBtnSeq" data-mode="json_calibration" class="mode-button" title="切换到JSON校准模式">JSON校准</button> 
                         </div>
                     </div>
                     <div class="tool-content-wrapper sequence-layout-wrapper">
                         <div class="sequence-column sequence-left-column"><h4 class="column-title">扫描与控制</h4><div class="sequence-controls">
                            <button id="analyzeSequences" class="tool-button">开始扫描文件夹</button>
                            <div id="sequenceAnalysisStatus" class="analysis-status"><p>点击按钮开始扫描...</p></div>
                        </div>
                        <button id="fixSequenceIssues" class="tool-button fix-button disabled" title="自动重命名文件以修复序号混乱">一键修复</button>

                    </div>
                         <div class="sequence-column sequence-right-column"><h4 class="column-title">问题列表 & 修复</h4><textarea id="sequenceIssuesList" class="scrollable-list sequence-issues-list" placeholder="序号异常的文件夹及文件将显示在此..." readonly></textarea></div>
                     </div>
                </div>
                <div id="jsonCalibrationPaneView" class="gu-tools-view hidden">
                    <div class="gu-tools-title-bar">
                        <div class="gu-tools-mode-buttons">
                             <button id="switchToGeneratorBtnJsonCal" data-mode="generator" class="mode-button" title="切换到JSON生成模式">JSON生成</button>
                             <button id="switchToImportBtnJsonCal" data-mode="import" class="mode-button" title="切换到图片入库模式">图片入库</button>
                             <button id="switchToMD5BtnJsonCal" data-mode="md5" class="mode-button" title="切换到MD5校准模式">MD5校准</button>
                             <button id="switchToSequenceBtnJsonCal" data-mode="sequence" class="mode-button" title="切换到序号管理模式">序号管理</button>
                             <button id="switchToJSONCalBtnJsonCal" data-mode="json_calibration" class="mode-button active" title="切换到JSON校准模式">JSON校准</button>
                        </div>
                    </div>
                    <div class="tool-content-wrapper json-calibration-layout-wrapper"> 
                        <div class="json-calibration-column json-calibration-left">
                            <h4 class="column-title">JSON 校准控制</h4>
                            <div class="json-calibration-controls">
                                <button id="startJsonCalibration" class="tool-button">开始 JSON 校准</button>
                                <div id="jsonCalibrationStatus" class="calibration-status"> 
                                    <p>检查 JSON 条目数: <span id="jsonEntriesCheckedCount">0</span></p>
                                    <p>检查图库文件数: <span id="jsonFilesCheckedCount">0</span></p>
                                    <p style="color: var(--error-color);">缺失文件记录数: <span id="missingFilesCount">0</span></p>
                                    <p id="jsonCalibrationProgress" style="font-size: 0.85em; color: var(--secondary-text-color); margin-top: 5px; min-height: 1.2em;"></p>
                                </div>
                                <progress id="jsonCalibrationProgressBar" value="0" max="100" style="width: 100%; margin-top: 10px; display: none;"></progress>
                                <button id="removeMissingEntriesBtn" class="tool-button fix-button full-width-button disabled" title="从 ImageData.json 中移除这些文件记录 (高风险!)" style="background: var(--error-color); border-color: #f87171;">移除缺失记录</button>
                            </div>
                        </div>
                        <div class="json-calibration-column json-calibration-right">
                            <h4 class="column-title">JSON 中存在但文件缺失列表 (<span id="missingFilesCountDisplay">0</span>)</h4>
                            <textarea id="missingFilesList" class="scrollable-list missing-files-list" placeholder="JSON 中记录但实际文件不存在的条目将显示在此..." readonly></textarea>
                        </div>
                    </div>
                </div>
            </div> 
            <div id="dataListPane" class="tab-pane">
                <div class="data-list-controls">
                    <div class="top-controls-row">
                        <div class="select-wrapper">
                            <select id="filterGame" class="cartoon-select">
                                <option value="">——所有游戏——</option>
                                <option value="gs-character">原神</option>
                                <option value="sr-character">星铁</option>
                                <option value="zzz-character">绝区零</option>
                                <option value="waves-character">鸣潮</option>
                                <option value="unknown">未知</option>
                            </select>
                        </div>
                        <div class="search-input-wrapper">
                            <input type="search" id="dataListSearchInput" class="cartoon-input search-input" placeholder=" 搜索角色/GID/角色别名/模糊查找......">
                        </div>
                    </div>
                    <div class="filter-controls">
                        <label class="filter-toggle-label">
                            <input type="checkbox" id="filterPx18" class="filter-toggle-checkbox">
                            <span class="filter-toggle-button" data-on="Px18 开" data-off="Px18 关">Px18 (轻色情)</span>
                        </label>
                        <label class="filter-toggle-label">
                            <input type="checkbox" id="filterRx18" class="filter-toggle-checkbox">
                            <span class="filter-toggle-button" data-on="Rx18 开" data-off="Rx18 关">Rx18 (重度色情)</span>
                        </label>
                        <label class="filter-toggle-label">
                            <input type="checkbox" id="filterNormal" class="filter-toggle-checkbox">
                            <span class="filter-toggle-button filter-toggle-layout" data-on="人像 开" data-off="人像 关">人像</span>
                        </label>
                        <label class="filter-toggle-label">
                            <input type="checkbox" id="filterFullscreen" class="filter-toggle-checkbox">
                            <span class="filter-toggle-button filter-toggle-layout" data-on="全屏 开" data-off="全屏 关">全屏</span>
                        </label>
                        <label class="filter-toggle-label">
                            <input type="checkbox" id="filterEasterEgg" class="filter-toggle-checkbox">
                            <span class="filter-toggle-button filter-toggle-special" data-on="彩蛋 开" data-off="彩蛋 关">彩蛋</span>
                        </label>
                        <label class="filter-toggle-label">
                            <input type="checkbox" id="filterAiImage" class="filter-toggle-checkbox">
                            <span class="filter-toggle-button filter-toggle-ai" data-on="AI 开" data-off="AI 关">AI 图</span>
                        </label>
                        <label class="filter-toggle-label">
                            <input type="checkbox" id="filterisBan" class="filter-toggle-checkbox">
                            <span class="filter-toggle-button filter-toggle-ban" data-on="封禁 开" data-off="封禁 关">封禁中</span>
                        </label>
                        <p id="dataListCountDisplay" style="text-align: right; margin: 0 0 0 auto; font-size: 1em;font-weight:700; color: #ffffff; white-space: nowrap;">当前显示: 0 条</p>
                    </div>
                </div>
                <div id="dataListContainer">
                    <p class="no-results" style="display: none;">没有找到匹配的数据。</p>
                    <div id="virtualScrollInner" style="position: relative; width: 100%; height: 0px;">
                        <div id="visibleItemsContainer" style="position: absolute; top: 0px; left: 0px; width: 100%; transform: translateY(0px);">
                        </div>
                    </div>
                </div>
            </div>

            <div id="localGalleryPane" class="tab-pane">
                <div class="local-gallery-wrapper">
                    <div class="local-left-panel">
                        <div class="form-group">
                            <label for="localFolderSearchInput">搜索角色文件夹:</label>
                            <div class="search-input-wrapper">
                                <input type="search" id="localFolderSearchInput" class="cartoon-input search-input" placeholder="输入角色名过滤...">
                            </div>
                        </div>
                        <div id="localSourceFilterButtons" class="source-filter-buttons">
                            <button class="source-filter-btn" data-source="gs-character">原神</button>
                            <button class="source-filter-btn" data-source="sr-character">星铁</button>
                            <button class="source-filter-btn" data-source="zzz-character">绝区零</button>
                            <button class="source-filter-btn" data-source="waves-character">鸣潮</button>
                            <button class="source-filter-btn active" data-source="all">全部</button>
                            <div class="filter-toggle-label" style="margin-top: 10px;">
                                <input type="checkbox" id="pluginToggleGuFilter" class="filter-toggle-checkbox">
                                <span class="filter-toggle-button gu-toggle-button" data-on="显示Gu" data-off="隐藏Gu">隐藏Gu</span>
                            </div>
                        </div>         
                        <div id="localFolderListContainer">
                            <p id="localFolderLoading" class="no-results">正在加载文件夹...</p>
                            <p id="localFolderNoResults" class="no-results hidden">未找到文件夹。</p>
                        </div>
                    </div>
                    <div class="local-middle-panel">
                        <div class="local-image-preview-area">
                            <div id="localImageGridPreviewContainer">
                                <p id="localPreviewPlaceholder" class="panel-placeholder">请从左侧选择一个文件夹以查看图片</p>
                                <div id="localImageGridPreview" class="hidden">
                                </div>
                            </div>
                            <div id="localPaginationControls" class="pagination-controls hidden">
                                <button id="localPrevPageBtn" class="pagination-btn">< 上一页</button>
                                <span id="localPageInfo" class="page-info">第 1 / 1 页</span>
                                <button id="localNextPageBtn" class="pagination-btn">下一页 ></button>
                            </div>
                        </div>
                        <div class="local-info-display-area">
                            <h4 class="panel-title">详细信息</h4>
                            <div id="localInfoContent" class="panel-content">
                                <p class="panel-placeholder">选中图片后在此显示详细信息。</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

             <div id="pluginGalleryPane" class="tab-pane"> 
                <div class="plugin-content-wrapper"> 
                    <div class="plugin-left-panel"> 
                        <div class="form-group">
                            <label for="pluginFolderSearchInput">搜索角色文件夹:</label>
                            <div class="search-input-wrapper">
                                <input type="search" id="pluginFolderSearchInput" class="cartoon-input search-input" placeholder="输入角色名过滤..."> 
                            </div>
                        </div>
                        <div id="pluginSourceFilterButtons" class="source-filter-buttons"> 
                            <button class="source-filter-btn active" data-source="all">全部</button>
                            <button class="source-filter-btn" data-source="miao">Miao</button>
                            <button class="source-filter-btn" data-source="zzz">ZZZ</button>
                            <button class="source-filter-btn" data-source="waves">Waves</button>
                        </div>
                        <div id="pluginFolderListContainer"> 
                            <p id="pluginFolderLoading" class="no-results">正在加载文件夹...</p> 
                            <p id="pluginFolderNoResults" class="no-results hidden">未找到文件夹。</p> 
                        </div>
                    </div>
                    <div class="plugin-middle-panel-preview"> 
                        <div id="pluginImageGridPreviewContainer"> 
                            <p id="pluginPreviewPlaceholder" class="panel-placeholder">请从左侧选择一个文件夹以查看图片</p> 
                            <div id="pluginImageGridPreview" class="hidden"> 
      
                            </div>
                        </div>
                        <div id="pluginPaginationControls" class="pagination-controls hidden"> 
                            <button id="pluginPrevPageBtn" class="pagination-btn">< 上一页</button> 
                            <span id="pluginPageInfo" class="page-info">第 1 / 1 页</span> 
                            <button id="pluginNextPageBtn" class="pagination-btn">下一页 ></button> 
                        </div>
                    </div>
                    <div class="plugin-right-panel-editor"> 
                        <h4 class="panel-title">图片属性 & 编辑</h4>
                        <div id="pluginAttributeInfoArea"> 
                            <p id="pluginEditorPlaceholder" class="panel-placeholder">请在中间选择一张图片查看属性</p> 
                        </div>
                    </div>
                </div>
            </div> 

            <div id="advancedManagementPane" class="tab-pane">
                <div class="adv-mgmt-content">
                    <div class="adv-mgmt-section">
                        <h3 class="section-title">数据维护</h3>
                        <div class="tool-grid">
                            <div class="tool-card">
                                <h4>孤立文件查找</h4>
                                <p class="tool-description">查找存在于文件系统但未记录在 JSON 中的图片。</p>
                                <button id="findOrphanedFilesBtn" class="tool-button-adv">开始查找</button>
                                <div class="tool-output hidden">
                                    <p>发现 <span id="orphanedCount">0</span> 个孤立文件:</p>
                                    <textarea id="orphanedFilesList" readonly placeholder="孤立文件列表..."></textarea>
                                    <button id="deleteOrphanedBtn" class="tool-button-adv danger disabled">删除选中 (待实现)</button>
                                    <button id="importOrphanedBtn" class="tool-button-adv primary disabled">导入选中 (待实现)</button>
                                </div>
                            </div>
                            <div class="tool-card">
                                <h4>重复文件查找 (基于 MD5)</h4>
                                <p class="tool-description">查找图库中 MD5 值完全相同的图片。</p>
                                <button id="findDuplicateFilesBtn" class="tool-button-adv">开始查找</button>
                                <div class="tool-output hidden">
                                     <p>发现 <span id="duplicateSetsCount">0</span> 组重复文件:</p>
                                     <div id="duplicateFilesList" class="scrollable-list-adv">重复文件列表...</div>
                                     <button id="manageDuplicatesBtn" class="tool-button-adv primary disabled">管理重复项 (待实现)</button>
                                </div>
                            </div>
                            <div class="tool-card">
                                <h4>缩略图缓存管理</h4>
                                <p class="tool-description">清理或重新生成图片缩略图缓存。</p>
                                <p>缓存大小: <span id="thumbnailCacheSize">未知</span></p>
                                <button id="clearThumbnailCacheBtn" class="tool-button-adv danger">清除缓存 (待实现)</button>
                                <button id="regenerateThumbnailCacheBtn" class="tool-button-adv">重新生成 (待实现)</button>
                            </div>
                        </div>
                    </div>
                    <div class="adv-mgmt-section">
                        <h3 class="section-title">批量操作</h3>
                         <div class="tool-grid">
                            <div class="tool-card">
                                <h4>批量属性编辑</h4>
                                <p class="tool-description">批量修改指定文件夹或图库内图片的属性。</p>
                                <button id="bulkEditAttributesBtn" class="tool-button-adv primary disabled">进入批量编辑 (待实现)</button>
                            </div>
                             <div class="tool-card">
                                <h4>文件夹管理</h4>
                                <p class="tool-description">重命名或移动角色文件夹 (高风险!)。</p>
                                <button id="manageFoldersBtn" class="tool-button-adv warning disabled">管理文件夹 (待实现)</button>
                            </div>
                        </div>
                    </div>
                    <div class="adv-mgmt-section">
                        <h3 class="section-title">系统与配置</h3>
                         <div class="tool-grid">
                            <div class="tool-card">
                                <h4>源目录管理</h4>
                                <p class="tool-description">查看和编辑图库扫描的源目录。</p>
                                <button id="manageSourceDirsBtn" class="tool-button-adv disabled">管理源目录 (待实现)</button>
                            </div>
                            <div class="tool-card">
                                <h4>数据备份与恢复</h4>
                                <p class="tool-description">备份或恢复核心 JSON 和配置文件。</p>
                                <button id="backupDataBtn" class="tool-button-adv primary">立即备份 (待实现)</button>
                                <button id="restoreDataBtn" class="tool-button-adv danger">从备份恢复 (待实现)</button>
                            </div>
                            <div class="tool-card">
                                <h4>日志查看器</h4>
                                <p class="tool-description">查看后端服务器运行日志。</p>
                                <button id="viewLogsBtn" class="tool-button-adv disabled">查看日志 (待实现)</button>
                            </div>
                        </div>
                    </div>
                    <div class="adv-mgmt-section danger-zone">
                        <h3 class="section-title danger">危险操作区域</h3>
                         <div class="tool-grid">
                             <div class="tool-card">
                                <h4>原始 JSON 编辑器</h4>
                                <p class="tool-description">直接编辑 ImageData.json 等文件 (极高风险!)。</p>
                                <button id="editRawJsonBtn" class="tool-button-adv danger disabled">打开编辑器 (待实现)</button>
                            </div>
                        </div>
                    </div>
                </div> 
            </div> 
            </div>
            <div id="toast-container"></div>

            <div id="editAttributeModal" class="modal-overlay hidden">
                <div class="modal-content">
                    <h4>修改图片属性</h4>
                    <div id="modalFilename" class="modal-filename">文件名: <span></span></div>
                    <input type="hidden" id="modalEntryPath">
                    <div class="modal-form">
                        <div class="modal-group">
                            <label class="modal-group-label">限制级:</label>
                            <div class="options-container">
                                <label><input type="radio" name="modalRating" value="none"> 无</label>
                                <label><input type="radio" name="modalRating" value="px18"> Px18 (轻色情)</label>
                                <label><input type="radio" name="modalRating" value="rx18"> Rx18 (重度色情)</label>
                            </div>
                        </div>
                        <div class="modal-group">
                            <label class="modal-group-label">构图:</label>
                            <div class="options-container">
                                <label><input type="radio" name="modalLayout" value="normal"> 人像图</label>
                                <label><input type="radio" name="modalLayout" value="fullscreen"> 全屏图</label>
                                <label><input type="radio" name="modalLayout" value="catcake"> [🐱猫猫糕🐱]</label>
                            </div>
                        </div>
                        <div class="modal-group">
                            <label class="modal-group-label">特殊:</label>
                            <div class="options-container">
                                <label><input type="checkbox" id="modalIsEasterEgg"> 彩蛋</label>
                                <label><input type="checkbox" id="modalIsAiImage"> AI图</label>
                                <label><input type="checkbox" id="modalisBan"> 封禁</label>
                            </div>
                        </div>
                    </div>
                    <div class="modal-actions">
                        <button id="modalSaveButton" class="modal-button modal-save">保存更改</button>
                        <button id="modalCancelButton" class="modal-button modal-cancel">取消</button>
                    </div>
                    <div id="modalMessageArea" class="modal-message"></div>
                </div>
            </div>
        </div>
        <div id="imageModalOverlay" class="image-modal-overlay hidden">
            <button id="modalCloseButton" class="modal-close-button">×</button>
            <div class="image-modal-content">
                <img id="modalImageViewer" src="" alt="放大的图片">
            </div>
        </div>
    </div>

<script   src="src/Core.js"></script>
<script   src="src/Ui_Controls.js"></script>
<script   src="src/Data_List.js"></script>
<script   src="src/Plugin_Gallery.js"></script> 
<script   src="src/Gu_Tools/GuTools_Main.js"></script>
<script   src="src/Gu_Tools/GuTools_Generator.js"></script>
<script   src="src/Gu_Tools/GuTools_Import.js"></script>
<script   src="src/Gu_Tools/GuTools_MD5.js"></script>
<script   src="src/Gu_Tools/GuTools_Sequence.js"></script>
<script   src="src/Gu_Tools/GuTools_JsonCal.js"></script>
</body>
</html>